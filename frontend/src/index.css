/* 专业字体导入 - 更具命理文化特色（必须放在最前面） */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=ZCOOL+XiaoWei&family=Ma+Shan+Zheng&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

/* 字体变量 */
:root {
  /* 标题字体 - 小薇体（具有书法韵味） */
  --font-heading: 'ZCOOL XiaoWei', 'Noto Serif SC', 'STKaiti', 'KaiTi', serif;
  
  /* 正文字体 - 思源宋体 */
  --font-body: 'Noto Serif SC', 'STSong', 'SimSun', 'Songti SC', serif;
  
  /* 特殊装饰字体 - 马善政毛笔字（用于大标题） */
  --font-calligraphy: 'Ma Shan Zheng', 'STXingkai', cursive;
  
  /* 等宽字体 - 用于命盘 */
  --font-mono: 'Noto Serif SC', 'STKaiti', monospace;
}

@layer base {
  :root {
    /* FateMaster.ai 风格 - Light Mode */
    --background: 0 0% 100%;
    /* #FFFFFF 白色 */
    --foreground: 0 0% 3.9%;
    /* #0A0A0A 近黑色 */

    /* 卡片 */
    --card: 0 0% 100%;
    /* #FFFFFF */
    --card-foreground: 0 0% 3.9%;
    /* #0A0A0A */

    /* 弹出层 */
    --popover: 0 0% 100%;
    /* #FFFFFF */
    --popover-foreground: 0 0% 3.9%;
    /* #0A0A0A */

    /* 主色 - 黑色系 */
    --primary: 0 0% 9%;
    /* #171717 深黑 */
    --primary-foreground: 0 0% 98%;
    /* #FAFAFA */

    /* 次级色 */
    --secondary: 0 0% 96.1%;
    /* #F5F5F5 浅灰 */
    --secondary-foreground: 0 0% 9%;
    /* #171717 */

    /* 静音色 */
    --muted: 0 0% 96.1%;
    /* #F5F5F5 */
    --muted-foreground: 0 0% 45.1%;
    /* #737373 中灰 */

    /* 强调色 */
    --accent: 0 0% 96.1%;
    /* #F5F5F5 */
    --accent-foreground: 0 0% 9%;
    /* #171717 */

    --liuyao-gold: 43 74% 66%;
    /* 图表金黄 */

    /* 危险色 */
    --destructive: 0 84.2% 60.2%;
    /* #EF4444 红色 */
    --destructive-foreground: 0 0% 98%;

    /* 边框与输入框 */
    --border: 0 0% 89.8%;
    /* #E5E5E5 */
    --input: 0 0% 89.8%;
    /* #E5E5E5 */
    --ring: 0 0% 3.9%;
    /* #0A0A0A */

    /* 图表色 */
    --chart-1: 12 76% 61%;
    /* 橙红 */
    --chart-2: 173 58% 39%;
    /* 青绿 */
    --chart-3: 197 37% 24%;
    /* 深青 */
    --chart-4: 43 74% 66%;
    /* 金黄 */
    --chart-5: 27 87% 67%;
    /* 橙色 */

    /* K线图专用颜色 */
    --kline-up: 142 71% 45%;
    /* 绿色上涨 #22c55e */
    --kline-up-stroke: 142 76% 36%;
    /* 深绿 #15803d */
    --kline-down: 0 84% 60%;
    /* 红色下跌 #ef4444 */
    --kline-down-stroke: 0 70% 41%;
    /* 深红 #b91c1c */
    --kline-grid: 220 14% 96%;
    /* 网格线 #f3f4f6 */
    --kline-axis: 220 13% 91%;
    /* 轴线 #e5e7eb */
    --kline-text: 220 9% 46%;
    /* 文字 #6b7280 */
    --kline-text-muted: 220 9% 64%;
    /* 浅文字 #9ca3af */
    --kline-ref: 215 13% 84%;
    /* 参考线 #cbd5e1 */
    --kline-dayun: 239 84% 67%;
    /* 大运标签 #6366f1 */

    /* 紫微斗数星曜亮度颜色 */
    --star-miao: 0 72% 51%;
    /* 庙 #dc2626 */
    --star-wang: 25 95% 53%;
    /* 旺 #f97316 */
    --star-de: 32 95% 44%;
    /* 得 #d97706 */
    --star-li: 142 76% 36%;
    /* 利 #16a34a */
    --star-ping: 215 16% 47%;
    /* 平 #475569 */
    --star-bu: 217 91% 60%;
    /* 不 #3b82f6 */
    --star-xian: 271 81% 56%;
    /* 陷 #a855f7 */
    --star-default: 215 16% 57%;
    /* 默认 #64748b */

    /* 圆角 */
    --radius: 0.5rem;
    /* 8px */

    /* 吉日选择页面颜色 */
    --jiri-yi: 25 95% 51%;
    /* 宜 - 橙色 #f77307 */
    --jiri-ji: 0 60% 44%;
    /* 忌 - 红色 #b2302e */
    --jiri-yi-light: 30 93% 95%;
    /* 宜浅色 #fef2e8 */
    --jiri-ji-light: 0 43% 92%;
    /* 忌浅色 #f3dfe0 */
    --jiri-border: 18 80% 73%;
    /* 边框 #d99d9a */
    --jiri-text: 9 50% 54%;
    /* 文字 #c45751 */

    /* 侧边栏 */
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    /* FateMaster.ai 风格 - Dark Mode */
    --background: 0 0% 3.9%;
    /* #0A0A0A 深黑 */
    --foreground: 0 0% 98%;
    /* #FAFAFA 白色 */

    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;

    --primary: 0 0% 98%;
    /* 反转 - 白色主色 */
    --primary-foreground: 0 0% 9%;

    --secondary: 0 0% 14.9%;
    /* #262626 */
    --secondary-foreground: 0 0% 98%;

    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    /* #A3A3A3 */

    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;

    --liuyao-gold: 43 74% 66%;

    --destructive: 0 62.8% 30.6%;
    /* 深红 */
    --destructive-foreground: 0 0% 98%;

    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;

    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;

    /* K线图专用颜色 - 暗色模式 */
    --kline-up: 142 71% 45%;
    --kline-up-stroke: 142 76% 36%;
    --kline-down: 0 84% 60%;
    --kline-down-stroke: 0 70% 41%;
    --kline-grid: 0 0% 20%;
    --kline-axis: 0 0% 25%;
    --kline-text: 0 0% 63%;
    --kline-text-muted: 0 0% 53%;
    --kline-ref: 0 0% 40%;
    --kline-dayun: 239 84% 67%;

    /* 紫微斗数星曜亮度颜色 - 暗色模式 */
    --star-miao: 0 72% 55%;
    --star-wang: 25 95% 58%;
    --star-de: 32 95% 50%;
    --star-li: 142 76% 45%;
    --star-ping: 215 16% 55%;
    --star-bu: 217 91% 65%;
    --star-xian: 271 81% 65%;
    --star-default: 215 16% 60%;

    /* 吉日选择页面颜色 - 暗色模式 */
    --jiri-yi: 25 95% 55%;
    --jiri-ji: 0 60% 50%;
    --jiri-yi-light: 25 30% 20%;
    --jiri-ji-light: 0 25% 20%;
    --jiri-border: 18 40% 50%;
    --jiri-text: 9 50% 65%;

    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
    -webkit-tap-highlight-color: transparent;
  }

  html {
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    scroll-behavior: smooth;
  }

  body {
    @apply bg-background text-foreground antialiased;
    font-family: var(--font-body), var(--font-geist-sans, ui-sans-serif), system-ui, sans-serif,
      "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-feature-settings: "rlig" 1, "calt" 1;
    overflow-x: hidden;
    min-height: 100vh;
    min-height: 100dvh;
  }

  /* 防止iOS上input放大 */
  input[type="text"],
  input[type="number"],
  input[type="email"],
  input[type="tel"],
  input[type="password"],
  input[type="date"],
  input[type="datetime-local"],
  input[type="time"],
  textarea,
  select {
    font-size: 16px !important;
  }

  @media (min-width: 640px) {
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="tel"],
    input[type="password"],
    input[type="date"],
    input[type="datetime-local"],
    input[type="time"],
    textarea,
    select {
      font-size: inherit !important;
    }
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-heading), var(--font-geist-sans, ui-sans-serif), system-ui, sans-serif;
    font-weight: 700;
    letter-spacing: 0.02em;
  }

  /* 命盘专用字体 */
  .font-chart {
    font-family: var(--font-mono);
    letter-spacing: 0.05em;
  }

  /* 书法装饰字体 */
  .font-calligraphy {
    font-family: var(--font-calligraphy);
    letter-spacing: 0.1em;
  }

  /* 标题专用字体 */
  .font-heading {
    font-family: var(--font-heading);
    letter-spacing: 0.02em;
  }
}

@layer utilities {
  .animate-in {
    animation-name: enter;
    animation-duration: 0.3s;
    animation-timing-function: ease-out;
  }

  .fade-in {
    animation-name: fadeIn;
  }

  /* FateMaster 风格玻璃态 */
  .glass {
    @apply backdrop-blur-sm border border-gray-100 shadow-sm;
    background: hsl(var(--card) / 0.95);
  }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
}

@keyframes enter {
  from {
    opacity: 0;
    transform: scale(0.95);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* 导出图片优化样式 */
.export-optimized {
  background: #ffffff !important;
  color: #2b2520 !important;
}

.export-optimized .prose {
  color: #2b2520 !important;
}

.export-optimized .prose h1,
.export-optimized .prose h2,
.export-optimized .prose h3,
.export-optimized .prose h4,
.export-optimized .prose h5,
.export-optimized .prose h6 {
  color: #1a1a1a !important;
}

.export-optimized .prose p {
  color: #2b2520 !important;
  font-size: 16px !important;
  line-height: 1.7 !important;
  margin-bottom: 1rem !important;
}

.export-optimized .prose ul,
.export-optimized .prose ol {
  color: #2b2520 !important;
}

.export-optimized .prose li {
  color: #2b2520 !important;
  font-size: 15px !important;
  line-height: 1.6 !important;
}

.export-optimized .prose strong {
  color: #1a1a1a !important;
}

.export-optimized .prose a {
  color: #d94a4a !important;
  text-decoration: underline !important;
}

/* 针对小六壬排盘的特殊优化 */
.export-optimized .six-palaces-grid {
  background: rgba(255, 255, 255, 0.95) !important;
  border-color: rgba(0, 0, 0, 0.1) !important;
}

.export-optimized .palace-item {
  background: rgba(255, 255, 255, 0.98) !important;
  border-color: rgba(0, 0, 0, 0.08) !important;
  color: #2b2520 !important;
}

.export-optimized .palace-title {
  color: #1a1a1a !important;
}

.export-optimized .palace-content {
  color: #2b2520 !important;
}

/* ------------------ 小六壬参考样式（从备份 styles.css 迁移关键样式） ------------------ */
/* 用于精确还原六宫格、斜向时间标签、宫格内部排版与颜色 */
.grid-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: auto auto;
  gap: 0;
  width: 100%;
  max-width: 550px;
  margin: 20px auto;
  justify-items: center;
  border: 3px solid hsl(var(--border) / 1);
  border-radius: 16px;
  background-color: hsl(var(--card) / 1);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.grid-cell {
  width: 180px;
  height: 200px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border: 1px solid hsl(var(--border) / 1);
  border-radius: 0;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
  background-color: hsl(var(--card) / 1);
  font-family: 'Noto Serif SC', serif;
  box-shadow: none;
  overflow: visible;
  /* allow rotated tag to extend outside corner (match reference) */
}

.grid-cell.final-result {
  background-color: #fff8e1;
  border: 2px solid #ffc107;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
  transform: scale(1.02);
}

.grid-cell.day-result {
  background-color: hsl(var(--card) / 1);
  border: 1px solid hsl(var(--border) / 1);
  box-shadow: none;
  transform: none;
}

.cell-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  justify-content: space-between;
  z-index: 1;
  position: relative;
}

.cell-top {
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  margin-bottom: 12px;
  flex-wrap: wrap;
  gap: 12px;
}

.god-name {
  font-size: 1.1rem;
  font-weight: bold;
  color: hsl(var(--foreground));
  letter-spacing: 0.02em;
  padding: 4px 8px;
  border-radius: 6px;
  display: inline-block;
  text-align: center;
  transition: all 0.3s ease;
  font-family: 'Noto Serif SC', serif;
  visibility: visible;
  opacity: 1;
  z-index: 10;
}

.god-name.self-position {
  color: hsl(var(--primary));
  font-weight: bold;
  text-shadow: 0 1px 2px hsl(var(--primary) / 0.3);
  position: relative;
}

.god-name.self-position::after {
  content: '●';
  color: hsl(var(--primary));
  position: absolute;
  right: -12px;
  top: -4px;
  font-size: 0.6rem;
}

.liuqin {
  font-size: 1rem;
  font-weight: 600;
  color: hsl(var(--destructive));
  background-color: hsl(var(--destructive) / 0.1);
  padding: 3px 10px;
  border-radius: 12px;
  border: 1px solid hsl(var(--destructive) / 0.2);
  white-space: nowrap;
  display: inline-block;
}

.liuqin.self-liuqin {
  color: hsl(var(--primary));
  background-color: hsl(var(--primary) / 0.1);
  border-color: hsl(var(--primary) / 0.3);
  font-weight: bold;
}

.five-star {
  font-size: 1rem;
  color: hsl(var(--chart-4));
  font-weight: 500;
  padding: 4px 10px;
  border-radius: 6px;
  background-color: hsl(var(--chart-4) / 0.05);
  display: inline-block;
  font-style: italic;
  text-align: left;
}

.six-god {
  font-size: 1rem;
  color: hsl(var(--destructive));
  font-weight: bold;
  padding: 6px 12px;
  border-radius: 6px;
  background-color: hsl(var(--destructive) / 0.2);
  display: inline-block;
  text-align: center;
  position: relative;
  z-index: 120;
  margin-left: 12px;
  visibility: visible !important;
  opacity: 1 !important;
  box-shadow: 0 2px 6px hsl(var(--destructive) / 0.3);
  min-width: 70px;
  border: 1px solid hsl(var(--destructive));
}

.element-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 6px;
  transition: all 0.3s ease;
  border-top: 1px solid hsl(var(--foreground) / 0.05);
}

/* 红色斜向标签：保留参考站点定位与视觉样式，但使用裁剪容器实现不会遮挡内容 */
.time-tags-container {
  /* 固定贴靠单格右上内角：容器大小 100x100，裁剪超出部分 */
  position: absolute;
  top: 0;
  right: 0;
  width: 100px;
  height: 100px;
  overflow: hidden;
  z-index: 50;
  pointer-events: none;
  /* 不阻挡宫格点击 */
}

.time-tag {
  /* 放在容器内侧并旋转45deg；调整 right/top 保证在右上角内斜伸 */
  position: absolute;
  right: -20px;
  top: 20px;
  transform: rotate(45deg);
  transform-origin: right top;
  padding: 6px 10px;
  font-size: 12px;
  line-height: 1;
  text-align: center;
  font-weight: 700;
  background-color: hsl(var(--destructive));
  color: hsl(var(--destructive-foreground));
  border: 1px solid hsl(var(--destructive) / 0.8);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.18);
  white-space: nowrap;
  border-radius: 4px;
  display: inline-block;
}

/* 强制覆盖：参考站点 time-tags 原始样式（保证像素一致） */
.time-tags-container.force-reference {
  /* Container positioned in cell corner; rotation applied only to inner tag */
  position: absolute !important;
  top: 8px !important;
  right: 8px !important;
  transform-origin: right top !important;
  transform: none !important;
  /* ensure single rotation on inner element only */
  z-index: 1200 !important;
  pointer-events: none !important;
  width: auto !important;
  height: auto !important;
  display: block !important;
}

.time-tag.force-reference {
  /* Smaller padding so the rotated tag stays within the cell while keeping reference look */
  padding: 6px 28px !important;
  font-size: 0.9rem !important;
  text-align: center !important;
  font-weight: 700 !important;
  background-color: hsl(var(--destructive)) !important;
  color: hsl(var(--destructive-foreground)) !important;
  border: 1px solid hsl(var(--destructive) / 0.8) !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.18) !important;
  white-space: nowrap !important;
  border-radius: 4px !important;
  display: inline-block !important;
  line-height: 1 !important;
}

/* Portal tag style (body-level) */
.portal-time-tag {
  padding: 6px 28px;
  background: hsl(var(--destructive));
  color: hsl(var(--destructive-foreground));
  border: 1px solid hsl(var(--destructive) / 0.8);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  border-radius: 4px;
  font-weight: 700;
  white-space: nowrap;
  display: inline-block;
  transform-origin: right top;
  font-size: 14px;
}

/* Vertical variant: narrow tall rectangle for right-top placement */
.portal-time-tag.vertical {
  width: 36px;
  height: 72px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  font-size: 13px;
}

/* 深色模式下的标签优雅适配 */
.dark .time-tag {
  background-color: hsl(var(--destructive));
  color: hsl(var(--destructive-foreground));
  border-color: hsl(var(--destructive) / 0.8);
  box-shadow: 0 1px 2px rgba(255, 255, 255, 0.1);
}

/* 响应式：移动端将斜向标签改为右上角紧凑标签（来自参考） */
@media (max-width: 768px) {
  .time-tags-container {
    top: 4px;
    right: 4px;
    transform: none;
  }

  .time-tag {
    font-size: 0.9rem;
    padding: 4px 12px;
    border-radius: 12px;
  }

  .grid-cell {
    width: 140px;
    height: 160px;
  }
}

/* ------------------ 结束迁移片段 ------------------ */

/* 参考站的详细信息弹窗样式（info-dialog） */
.info-dialog {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* 降低遮罩强度并移除模糊，保持对话框清晰可读 */
  background: rgba(0, 0, 0, 0.36);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  opacity: 1;
  visibility: visible;
  backdrop-filter: none;
}

.info-dialog .dialog-content {
  /* 使用接近纯白的实底，确保与背景有足够对比 */
  background: rgba(255, 255, 255, 0.98);
  border-radius: 16px;
  padding: 28px;
  max-width: 820px;
  width: 92%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.18);
  border: 1px solid rgba(0, 0, 0, 0.08);
  color: #111827;
  /* 更深的文字颜色 */
  font-size: 15px;
  line-height: 1.6;
}

.info-dialog .close-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--card);
  border: 1px solid hsl(var(--border) / 1);
  color: var(--card-foreground);
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

.info-dialog .content-wrapper {
  display: flex;
  gap: 24px;
}

.info-dialog .basic-info {
  flex: 1;
  background: transparent;
  padding: 8px;
}

.info-dialog .validation-section {
  flex: 1;
  background: transparent;
  padding: 8px;
}

.info-dialog .basic-info p,
.info-dialog .validation-section p {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid hsl(var(--border) / 0.6);
}

.info-dialog .basic-info p:last-child,
.info-dialog .validation-section p:last-child {
  border-bottom: none;
}

.info-dialog .basic-info strong {
  color: var(--secondary);
  font-weight: 700;
}

.info-dialog .value {
  font-weight: 700;
  color: var(--card-foreground);
}

/* ------------------ 参考站弹窗完整样式（逐节点对齐） ------------------ */

/* 详细信息对话框样式 - 北京验收白色弹窗 */
.info-dialog-reference {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(8px);
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* 对话框整体样式 */
.info-dialog-reference .dialog-content {
  background-color: white;
  border: 3px solid #d4d4d8;
  border-radius: 16px;
  width: 90%;
  max-width: 800px;
  max-height: 80vh;
  overflow-y: auto;
  z-index: 1000;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  animation: slideUp 0.3s ease-out;
  position: relative;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 对话框头部 - 只包含关闭按钮 */
.info-dialog-reference .dialog-header {
  background-color: #f8fafc;
  border-bottom: 2px solid #e2e8f0;
  padding: 10px 20px;
  margin: 0;
  text-align: right;
  position: relative;
  border-radius: 13px 13px 0 0;
  border-top: none;
  border-left: none;
  border-right: none;
}

/* 基础信息区域的标题样式 */
.info-dialog-reference .section-title {
  color: #1e293b;
  font-size: 20px;
  font-weight: 700;
  font-family: 'Noto Serif SC', serif;
  margin: 0 0 20px 0;
  padding-bottom: 10px;
  border-bottom: 2px solid #e2e8f0;
  text-align: left;
}

/* 关闭按钮 - 右上角 */
.info-dialog-reference .close-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: white;
  border: 1px solid #e2e8f0;
  color: #64748b;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}

.info-dialog-reference .close-btn:hover {
  background-color: #e2e8f0;
  color: #1e293b;
  transform: scale(1.1);
}

/* 对话框内容区域 - 左右布局，确保在圆角方框内部 */
.info-dialog-reference .dialog-content>div.content-wrapper {
  padding: 24px;
  background-color: white;
}

/* 内容容器 - 左右两列布局 */
.info-dialog-reference .content-wrapper {
  display: flex;
  gap: 24px;
}

/* 左侧基础信息区域 */
.info-dialog-reference .basic-info {
  flex: 1;
  background-color: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* 右侧校准验证信息区域 */
.info-dialog-reference .validation-section {
  flex: 1;
  background-color: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  padding: 20px;
  margin: 0;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* 验证区域标题 */
.info-dialog-reference .validation-section h4 {
  margin-bottom: 16px;
  color: #3b82f6;
  font-size: 18px;
  font-weight: 600;
  text-align: center;
  border-bottom: 2px solid #e2e8f0;
  padding-bottom: 8px;
}

/* 基础信息文本样式 */
.info-dialog-reference .basic-info p {
  margin: 12px 0;
  line-height: 1.6;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #e2e8f0;
}

.info-dialog-reference .basic-info p:last-child {
  border-bottom: none;
}

/* 验证信息文本样式 */
.info-dialog-reference .validation-section p {
  margin: 12px 0;
  line-height: 1.6;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #e2e8f0;
}

.info-dialog-reference .validation-section p:last-child {
  border-bottom: none;
}

/* 标签样式 */
.info-dialog-reference strong {
  color: #475569;
  font-weight: 600;
  flex: 1;
  font-size: 15px;
}

/* 数值样式 */
.info-dialog-reference .value {
  font-weight: 700;
  color: #1e293b;
  text-align: right;
  min-width: 120px;
  font-size: 15px;
  font-family: 'Noto Serif SC', serif;
}

/* 暗色主题适配 */
.dark-theme .info-dialog-reference .dialog-content {
  background-color: #1e293b;
  border-color: #334155;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.dark-theme .info-dialog-reference .dialog-header {
  background-color: #0f172a;
  border-bottom-color: #334155;
  border-radius: 13px 13px 0 0;
  border-top: none;
  border-left: none;
  border-right: none;
}

.dark-theme .info-dialog-reference .section-title {
  color: #f8fafc;
  border-bottom-color: #334155;
}

.dark-theme .info-dialog-reference .dialog-header h3 {
  color: #f8fafc;
}

.dark-theme .info-dialog-reference .dialog-content>div {
  background-color: #1e293b;
}

.dark-theme .info-dialog-reference .basic-info,
.dark-theme .info-dialog-reference .validation-section {
  background-color: #0f172a;
  border-color: #334155;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
}

.dark-theme .info-dialog-reference strong {
  color: #cbd5e1;
}

.dark-theme .info-dialog-reference .value {
  color: #f8fafc;
}

.dark-theme .info-dialog-reference .validation-section h4 {
  color: #60a5fa;
  border-bottom-color: #334155;
}

.dark-theme .info-dialog-reference .close-btn {
  background-color: #0f172a;
  border-color: #334155;
  color: #cbd5e1;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.dark-theme .info-dialog-reference .close-btn:hover {
  background-color: #1e293b;
  color: #f8fafc;
  transform: scale(1.1);
}

.dark-theme .info-dialog-reference .basic-info p,
.dark-theme .info-dialog-reference .validation-section p {
  border-bottom-color: #334155;
}

/* ------------------ 结束参考站弹窗样式 ------------------ */

/* ------------------ 六爻专用样式 ------------------ */
.no-scrollbar::-webkit-scrollbar {
  display: none;
}

.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.writing-vertical-rl {
  writing-mode: vertical-rl;
}

.writing-vertical {
  writing-mode: vertical-rl;
  text-orientation: upright;
  letter-spacing: 0.2em;
}

.h-safe-top {
  height: env(safe-area-inset-top, 0px);
}

/* ------------------ AI输出内容统一样式 ------------------ */
/* 优化排版、字体大小、行间距，使内容更易读 */
/* 参考 FateMaster.ai 的排版风格 */

/* 基础prose样式覆盖 */
.prose {
  font-size: 16px;
  line-height: 1.875;
  color: hsl(var(--foreground));
  letter-spacing: 0.02em;
  max-width: 75ch;  /* 限制最大宽度，提升大屏可读性 */
}

.prose p {
  margin-bottom: 1.25rem;
  line-height: 2;
  text-align: justify;
}

/* 标题样式 - 层次分明，参考 FateMaster 风格 */
.prose h1 {
  font-size: 2rem;
  font-weight: 800;
  margin-top: 2rem;
  margin-bottom: 1.25rem;
  padding-bottom: 0.625rem;
  border-bottom: 2px solid hsl(var(--border));
  color: hsl(var(--foreground));
  letter-spacing: 0.03em;
  line-height: 1.2;
}

.prose h2 {
  font-size: 1.625rem;
  font-weight: 700;
  margin-top: 2rem;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid hsl(var(--border) / 0.5);
  color: hsl(var(--foreground));
  letter-spacing: 0.02em;
  line-height: 1.35;
}

.prose h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin-top: 1.5rem;
  margin-bottom: 0.875rem;
  color: hsl(var(--foreground));
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.prose h4 {
  font-size: 1.125rem;
  font-weight: 600;
  margin-top: 1.25rem;
  margin-bottom: 0.75rem;
  color: hsl(var(--foreground) / 0.95);
}

.prose h5,
.prose h6 {
  font-size: 1.0625rem;
  font-weight: 600;
  margin-top: 1rem;
  margin-bottom: 0.625rem;
  color: hsl(var(--foreground) / 0.9);
}

/* 列表样式 - 间距更舒适 */
.prose ul,
.prose ol {
  margin: 1rem 0;
  padding-left: 1.75rem;
}

.prose li {
  margin-bottom: 0.625rem;
  line-height: 1.875;
  color: hsl(var(--foreground) / 0.85);
}

.prose li::marker {
  color: hsl(var(--primary) / 0.6);
}

.prose ul>li {
  list-style-type: disc;
}

.prose ol>li {
  list-style-type: decimal;
}

/* 嵌套列表 */
.prose ul ul,
.prose ol ol,
.prose ul ol,
.prose ol ul {
  margin-top: 0.375rem;
  margin-bottom: 0.375rem;
}

/* 强调文本 */
.prose strong {
  font-weight: 600;
  color: hsl(var(--foreground));
}

.prose em {
  font-style: italic;
  color: hsl(var(--foreground) / 0.9);
}

/* 引用块样式 - 参考 FateMaster 风格 */
.prose blockquote {
  margin: 1.5rem 0;
  padding: 1rem 1.25rem;
  border-left: 4px solid hsl(var(--primary) / 0.7);
  background: hsl(var(--muted) / 0.2);
  border-radius: 0 6px 6px 0;
  font-weight: 500;
  font-style: italic;
  color: hsl(var(--foreground) / 0.85);
}

.prose blockquote p {
  margin: 0;
  line-height: 1.75;
  font-weight: inherit;
}

/* 代码样式 - 参考 FateMaster 风格 */
.prose code {
  font-size: 0.875em;
  font-weight: 600;
  padding: 0.2em 0.4em;
  background: hsl(var(--muted) / 0.5);
  border-radius: 0.3125rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
}

.prose pre {
  margin: 1.5rem 0;
  padding: 0.875rem 1.125rem;
  background: hsl(var(--muted) / 0.35);
  border-radius: 0.375rem;
  overflow-x: auto;
  font-size: 0.875em;
  line-height: 1.7;
}

.prose pre code {
  padding: 0;
  background: transparent;
  font-weight: 400;
  font-size: inherit;
}

/* 表格样式 */
.prose table {
  width: 100%;
  margin: 1rem 0;
  border-collapse: collapse;
  font-size: 0.9em;
}

.prose th,
.prose td {
  padding: 0.625rem 0.875rem;
  border: 1px solid hsl(var(--border));
  text-align: left;
}

.prose th {
  background: hsl(var(--muted) / 0.5);
  font-weight: 600;
  color: hsl(var(--foreground));
}

.prose tr:nth-child(even) {
  background: hsl(var(--muted) / 0.2);
}

/* 分割线 */
.prose hr {
  margin: 1.5rem 0;
  border: none;
  border-top: 1px solid hsl(var(--border));
}

/* 命运箴言特殊样式 */
.prose p:last-child:has(「),
.prose p:last-of-type {
  margin-top: 1.25rem;
}

/* 包含「」的段落 - 箴言风格 */
.prose p:contains("「"),
.prose p:contains("命运箴言"),
.prose p:contains("箴言") {
  font-style: italic;
  text-align: center;
  color: hsl(var(--primary) / 0.8);
  padding: 0.75rem;
  background: hsl(var(--primary) / 0.05);
  border-radius: 8px;
  margin-top: 1.5rem;
}

/* 流式输出光标动画 */
.streaming-content {
  position: relative;
}

.cursor-blink {
  animation: blink 1s infinite;
}

@keyframes blink {

  0%,
  50% {
    opacity: 1;
  }

  51%,
  100% {
    opacity: 0;
  }
}

/* 移动端适配 - 保持良好可读性 */
@media (max-width: 640px) {
  .prose {
    font-size: 15px;
    line-height: 1.8;
    letter-spacing: 0.01em;
    max-width: 100%;  /* 移动端全宽 */
  }

  .prose p {
    margin-bottom: 1rem;
  }

  .prose h1 {
    font-size: 1.625rem;
    font-weight: 800;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    line-height: 1.25;
  }

  .prose h2 {
    font-size: 1.375rem;
    margin-top: 1.5rem;
    margin-bottom: 0.875rem;
    line-height: 1.35;
  }

  .prose h3 {
    font-size: 1.2rem;
    margin-top: 1.25rem;
    margin-bottom: 0.75rem;
  }

  .prose ul,
  .prose ol {
    padding-left: 1.5rem;
    margin: 0.875rem 0;
  }

  .prose li {
    margin-bottom: 0.5rem;
    line-height: 1.75;
  }

  .prose blockquote {
    padding: 0.875rem 1rem;
    margin: 1.25rem 0;
  }

  .prose pre {
    padding: 0.75rem 1rem;
    font-size: 0.8125em;
  }
}

/* 暗色模式微调 */
.dark .prose {
  color: hsl(var(--foreground) / 0.95);
}

.dark .prose h1,
.dark .prose h2,
.dark .prose h3 {
  color: hsl(var(--foreground));
}

.dark .prose blockquote {
  background: hsl(var(--muted) / 0.15);
  border-left-color: hsl(var(--primary) / 0.4);
}

.dark .prose th {
  background: hsl(var(--muted) / 0.3);
}

.dark .prose tr:nth-child(even) {
  background: hsl(var(--muted) / 0.1);
}

/* ------------------ 结束AI输出内容样式 ------------------ */