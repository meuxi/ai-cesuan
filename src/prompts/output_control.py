"""
è¾“å‡ºæ§åˆ¶æ¨¡å— - ç”¨æˆ·ä½“éªŒä¼˜å…ˆæ¨¡å¼

ã€æ ¸å¿ƒç†å¿µã€‘
- æ¯ä¸ªå·¥å…·æœ‰ä¸“ä¸šçš„è¾“å‡ºæ¡†æ¶
- ä»å¤šè§’åº¦ç”Ÿæˆå®Œæ•´çš„åˆ†ææŠ¥å‘Š
- ç»“æ„æ¸…æ™°ï¼Œå†…å®¹ä¸“ä¸šï¼Œä¸å†—ä½™
"""
from enum import Enum
from dataclasses import dataclass, field
from typing import Optional, Dict, Any, List
import logging

logger = logging.getLogger(__name__)


class OutputMode(Enum):
    """è¾“å‡ºæ¨¡å¼"""
    DETAILED = "detailed"   # è¯¦ç»†æ¨¡å¼ï¼ˆç»Ÿä¸€ä½¿ç”¨ï¼‰


@dataclass
class OutputConfig:
    """è¾“å‡ºé…ç½®"""
    mode: OutputMode = OutputMode.DETAILED
    max_tokens: int = 16000
    output_framework: str = ""  # è¾“å‡ºæ¡†æ¶æ¨¡æ¿


# ==================== å„å·¥å…·è¾“å‡ºæ¡†æ¶ ====================

# å…«å­—å‘½ç†è¾“å‡ºæ¡†æ¶
BAZI_FRAMEWORK = """
## ğŸ“Š å…«å­—å‘½ç›˜
[ç®€æ´å±•ç¤ºå››æŸ±å…«å­—ã€çº³éŸ³äº”è¡Œã€è—å¹²é€å‡º]

## ğŸ¯ æ ¸å¿ƒç»“è®º
- **æ—¥ä¸»å¼ºå¼±**ï¼š[å¼º/å¼±/ä¸­å’Œï¼Œä¸€å¥è¯è¯´æ˜]
- **æ ¼å±€åˆ¤å®š**ï¼š[XXæ ¼ï¼Œç®€è¿°æ ¼å±€ç‰¹ç‚¹]
- **ç”¨ç¥å–œå¿Œ**ï¼šå–œ[X]å¿Œ[X]

## ğŸ“ˆ äº”è¡Œåˆ†æ
| äº”è¡Œ | åŠ›é‡ | çŠ¶æ€ |
|------|------|------|
[äº”è¡ŒåŠ›é‡è¡¨æ ¼]

## ğŸ‘¤ æ€§æ ¼ç‰¹å¾
[åŸºäºåç¥é…ç½®åˆ†ææ€§æ ¼ï¼Œ3-5æ¡è¦ç‚¹]

## ğŸ’¼ äº‹ä¸šè´¢è¿
- **é€‚åˆè¡Œä¸š**ï¼š[åˆ—å‡º2-3ä¸ª]
- **å‘å±•æ–¹å‘**ï¼š[ç®€è¿°]
- **è´¢è¿ç‰¹ç‚¹**ï¼š[æ­£è´¢/åè´¢å€¾å‘ï¼Œæ±‚è´¢æ–¹å¼]

## ğŸ’• å©šå§»æ„Ÿæƒ…
- **é…å¶ç‰¹å¾**ï¼š[ç®€è¿°]
- **å©šæœŸé¢„æµ‹**ï¼š[å…·ä½“å¹´ä»½æˆ–å¹´é¾„æ®µ]

## ğŸ¥ å¥åº·æé†’
[æ ¹æ®äº”è¡Œåæ¯æŒ‡å‡ºéœ€æ³¨æ„çš„æ–¹é¢]

## ğŸ“… å¤§è¿æµå¹´
- **å½“å‰å¤§è¿**ï¼š[Xå²-Xå²ï¼Œå¹²æ”¯ï¼Œè¿åŠ¿ç‰¹ç‚¹]
- **å…³é”®å¹´ä»½**ï¼š[åˆ—å‡ºæœªæ¥3-5ä¸ªé‡è¦å¹´ä»½åŠç®€æ]

## ğŸ’¡ è°ƒç†å»ºè®®
- **å‰åˆ©æ–¹ä½**ï¼š[Xæ–¹]
- **å¹¸è¿é¢œè‰²**ï¼š[Xè‰²]
- **å¼€è¿å»ºè®®**ï¼š[1-2æ¡å…·ä½“å»ºè®®]
"""

# å…­çˆ»é¢„æµ‹è¾“å‡ºæ¡†æ¶
LIUYAO_FRAMEWORK = """
## ğŸ² å¦è±¡ä¿¡æ¯
- **æœ¬å¦**ï¼š[å¦å] â†’ **å˜å¦**ï¼š[å¦å]
- **ä¸–çˆ»**ï¼š[Xçˆ»] | **åº”çˆ»**ï¼š[Xçˆ»]
- **åŠ¨çˆ»**ï¼š[ç¬¬Xçˆ»]

## ğŸ¯ æ ¸å¿ƒæ–­è¯­
[ä¸€å¥è¯ç›´æ–­å‰å‡¶ç»“æœ]

**æˆåŠŸæ¦‚ç‡**ï¼š[XX%]
**åº”æœŸ**ï¼š[å†œå†Xæœˆ/Xæ—¥å‰å]

## ğŸ“Š ç”¨ç¥åˆ†æ
- **ç”¨ç¥**ï¼š[XXçˆ»ï¼Œå…­äº²ï¼Œäº”è¡Œ]
- **ç”¨ç¥çŠ¶æ€**ï¼š[æ—ºç›¸ä¼‘å›šæ­»]
- **åŸç¥**ï¼š[çŠ¶æ€] | **å¿Œç¥**ï¼š[çŠ¶æ€]

## ğŸ” å…³é”®çˆ»åˆ†æ
[ä»…åˆ†æä¸é—®äº‹ç›¸å…³çš„å…³é”®çˆ»ï¼Œä¸éœ€é€çˆ»]

## ğŸ“ˆ äº‹æ€å‘å±•
- **å½“å‰çŠ¶å†µ**ï¼š[ç®€è¿°]
- **å‘å±•è¶‹åŠ¿**ï¼š[ç®€è¿°]
- **æœ€ç»ˆç»“æœ**ï¼š[ç®€è¿°]

## ğŸ’¡ è¡ŒåŠ¨å»ºè®®
- **å®œ**ï¼š[å…·ä½“å»ºè®®]
- **å¿Œ**ï¼š[éœ€é¿å…çš„äº‹é¡¹]
- **æœ€ä½³æ—¶æœº**ï¼š[å…·ä½“æ—¶é—´]
"""

# å¡”ç½—ç‰Œè¾“å‡ºæ¡†æ¶
TAROT_FRAMEWORK = """
## ğŸƒ ç‰Œé¢å±•ç¤º
[æ¯å¼ ç‰Œï¼šç‰Œå + æ­£/é€†ä½ï¼Œä¸€è¡Œä¸€å¼ ]

## ğŸ¯ æ ¸å¿ƒä¸»é¢˜
[ä¸€å¥è¯æ¦‚æ‹¬è¿™æ¬¡å åœçš„æ ¸å¿ƒä¿¡æ¯]

## ğŸ”® é€å¼ è§£è¯»
### [ä½ç½®1åç§°]ï¼š[ç‰Œå]ï¼ˆæ­£/é€†ä½ï¼‰
[è¯¥ç‰Œåœ¨æ­¤ä½ç½®å¯¹é—®é¢˜çš„å«ä¹‰ï¼Œ2-3å¥è¯]

### [ä½ç½®2åç§°]ï¼š[ç‰Œå]ï¼ˆæ­£/é€†ä½ï¼‰
[è¯¥ç‰Œåœ¨æ­¤ä½ç½®å¯¹é—®é¢˜çš„å«ä¹‰ï¼Œ2-3å¥è¯]

[...å…¶ä»–ä½ç½®...]

## ğŸ“– ç»¼åˆåˆ†æ
[ç‰Œé¢ä¹‹é—´çš„å…³è”ï¼Œæ•´ä½“æ•…äº‹çº¿]

## ğŸ’¡ è¡ŒåŠ¨å»ºè®®
- **åº”è¯¥åš**ï¼š[å…·ä½“å»ºè®®]
- **é¿å…åš**ï¼š[éœ€æ³¨æ„çš„äº‹é¡¹]

## âœ¨ å¯„è¯­
[æ¸©æš–é¼“åŠ±çš„ç»“æŸè¯­ï¼Œ1-2å¥è¯]
"""

# ç´«å¾®æ–—æ•°è¾“å‡ºæ¡†æ¶
ZIWEI_FRAMEWORK = """
## ğŸŒŸ å‘½ç›˜æ¦‚è§ˆ
- **å‘½å®«ä¸»æ˜Ÿ**ï¼š[ä¸»æ˜Ÿåç§°]
- **èº«å®«ä¸»æ˜Ÿ**ï¼š[ä¸»æ˜Ÿåç§°]
- **å‘½ç›˜æ ¼å±€**ï¼š[æ ¼å±€åç§°ï¼Œç®€è¿°]

## ğŸ¯ æ ¸å¿ƒç‰¹è´¨
[åŸºäºå‘½å®«ä¸»æ˜Ÿçš„æ ¸å¿ƒæ€§æ ¼å’Œäººç”Ÿä¸»é¢˜ï¼Œ3-4å¥è¯]

## ğŸ“Š åäºŒå®«é‡ç‚¹
| å®«ä½ | ä¸»æ˜Ÿ | å…³é”®ä¿¡æ¯ |
|------|------|----------|
| å‘½å®« | [æ˜Ÿ] | [ä¸€å¥è¯] |
| è´¢å¸› | [æ˜Ÿ] | [ä¸€å¥è¯] |
| å®˜ç¦„ | [æ˜Ÿ] | [ä¸€å¥è¯] |
| å¤«å¦» | [æ˜Ÿ] | [ä¸€å¥è¯] |

## ğŸ’¼ äº‹ä¸šå‘å±•
- **é€‚åˆé¢†åŸŸ**ï¼š[2-3ä¸ªæ–¹å‘]
- **å‘å±•å»ºè®®**ï¼š[ç®€è¿°]

## ğŸ’• æ„Ÿæƒ…å©šå§»
- **æ„Ÿæƒ…ç‰¹ç‚¹**ï¼š[ç®€è¿°]
- **é…å¶ç‰¹å¾**ï¼š[ç®€è¿°]

## ğŸ“… å¤§é™è¿åŠ¿
- **å½“å‰å¤§é™**ï¼š[å¹´é¾„æ®µï¼Œè¿åŠ¿ç‰¹ç‚¹]
- **ä¸‹æ­¥å¤§é™**ï¼š[å¹´é¾„æ®µï¼Œè¿åŠ¿å˜åŒ–]

## ğŸ’¡ å¼€è¿æŒ‡å—
[2-3æ¡å…·ä½“å¯è¡Œçš„å»ºè®®]
"""

# å°å…­å£¬è¾“å‡ºæ¡†æ¶
XIAOLIU_FRAMEWORK = """
## ğŸ¯ å¦è±¡é€Ÿæ–­
**å¤©å®«**ï¼š[å…­ç¥] | **åœ°å®«**ï¼š[å…­ç¥] | **äººå®«**ï¼š[å…­ç¥]

## âš¡ æ ¸å¿ƒç»“è®º
[ä¸€å¥è¯ç›´æ–­å‰å‡¶]

**æˆåŠŸæ¦‚ç‡**ï¼š[XX%]
**åº”æœŸ**ï¼š[è¿‘æœŸXå¤©/Xå‘¨å†…]

## ğŸ“Š ä¸‰å®«è§£æ
- **å¤©å®«[å…­ç¥]**ï¼š[å¯¹äº‹æƒ…çš„å½±å“]
- **åœ°å®«[å…­ç¥]**ï¼š[å¯¹äº‹æƒ…çš„å½±å“]  
- **äººå®«[å…­ç¥]**ï¼š[æœ€ç»ˆç»“æœæŒ‡å‘]

## ğŸ”„ äº”è¡Œå…³ç³»
[ä¸‰å®«äº”è¡Œç”Ÿå…‹å…³ç³»åŠå¯¹é—®äº‹çš„å½±å“]

## ğŸ’¡ è¡ŒåŠ¨æŒ‡å—
- **å®œ**ï¼š[å…·ä½“å»ºè®®]
- **å¿Œ**ï¼š[éœ€é¿å…]
- **å‰æ—¶**ï¼š[æœ‰åˆ©æ—¶è¾°/æ—¥æœŸ]
"""

# å‘¨å…¬è§£æ¢¦è¾“å‡ºæ¡†æ¶
DREAM_FRAMEWORK = """
## ğŸŒ™ æ¢¦å¢ƒè¦ç´ 
[åˆ—å‡ºæ¢¦å¢ƒä¸­çš„å…³é”®å…ƒç´ ï¼šåœºæ™¯ã€äººç‰©ã€ç‰©å“]

## ğŸ¯ æ ¸å¿ƒå¯“æ„
[ä¸€å¥è¯æ¦‚æ‹¬æ¢¦å¢ƒçš„æ ¸å¿ƒä¿¡æ¯]

## ğŸ“– ä¼ ç»Ÿè§£æ
[å‘¨å…¬è§£æ¢¦å…¸ç±ä¸­çš„è±¡å¾æ„ä¹‰]

## ğŸ§  å¿ƒç†åˆ†æ
[ä»å¿ƒç†å­¦è§’åº¦åˆ†ææ¢¦å¢ƒåæ˜ çš„å†…åœ¨çŠ¶æ€]

## ğŸ”® ç°å®æŒ‡å¼•
- **é¢„ç¤º**ï¼š[å¯èƒ½é¢„ç¤ºçš„äº‹æƒ…]
- **æé†’**ï¼š[éœ€è¦æ³¨æ„çš„æ–¹é¢]

## ğŸ’¡ å»ºè®®
[1-2æ¡å…·ä½“çš„è¡ŒåŠ¨æˆ–å¿ƒæ€è°ƒæ•´å»ºè®®]
"""

# å§“åæµ‹ç®—è¾“å‡ºæ¡†æ¶
NAME_FRAMEWORK = """
## ğŸ“ å§“åä¿¡æ¯
**å§“å**ï¼š[å§“å] | **ç¬”ç”»**ï¼š[X-X-X]

## ğŸ“Š äº”æ ¼æ•°ç†
| æ ¼å±€ | æ•°ç† | å‰å‡¶ | å«ä¹‰ |
|------|------|------|------|
| å¤©æ ¼ | [X] | [å‰/å‡¶] | [ä¸€å¥è¯] |
| äººæ ¼ | [X] | [å‰/å‡¶] | [ä¸€å¥è¯] |
| åœ°æ ¼ | [X] | [å‰/å‡¶] | [ä¸€å¥è¯] |
| å¤–æ ¼ | [X] | [å‰/å‡¶] | [ä¸€å¥è¯] |
| æ€»æ ¼ | [X] | [å‰/å‡¶] | [ä¸€å¥è¯] |

## ğŸ¯ ä¸‰æ‰é…ç½®
**[å¤©-äºº-åœ°]**ï¼š[äº”è¡Œé…ç½®è¯„ä»·]

## ğŸ“ˆ ç»¼åˆè¯„åˆ†
**[XXåˆ†/100åˆ†]**

## ğŸ’¡ åå­—ç‰¹ç‚¹
[å­—ä¹‰å¯“æ„ã€éŸ³éŸµè¯„ä»·ï¼Œ2-3å¥è¯]

## ğŸ“Œ ä½¿ç”¨å»ºè®®
[åŸºäºå§“åç‰¹ç‚¹çš„å»ºè®®]
"""

# æ¢…èŠ±æ˜“æ•°è¾“å‡ºæ¡†æ¶
MEIHUA_FRAMEWORK = """
## ğŸŒ¸ å¦è±¡ä¿¡æ¯
- **æœ¬å¦**ï¼š[ä¸Šå¦][ä¸‹å¦] = [å¦å]
- **äº’å¦**ï¼š[å¦å]
- **å˜å¦**ï¼š[å¦å]
- **ä½“å¦**ï¼š[Xå¦ï¼Œäº”è¡Œ] | **ç”¨å¦**ï¼š[Xå¦ï¼Œäº”è¡Œ]

## ğŸ¯ æ ¸å¿ƒæ–­è¯­
[ä¸€å¥è¯ç›´æ–­å‰å‡¶]

**æˆåŠŸæ¦‚ç‡**ï¼š[XX%]

## ğŸ“Š ä½“ç”¨ç”Ÿå…‹
[ä½“ç”¨äº”è¡Œå…³ç³»åˆ†æï¼Œå¯¹é—®äº‹çš„å½±å“]

## ğŸ”® äº‹æ€åˆ†æ
- **ç°çŠ¶**ï¼ˆæœ¬å¦ï¼‰ï¼š[ç®€è¿°]
- **è¿‡ç¨‹**ï¼ˆäº’å¦ï¼‰ï¼š[ç®€è¿°]
- **ç»“æœ**ï¼ˆå˜å¦ï¼‰ï¼š[ç®€è¿°]

## â° åº”æœŸæ¨æ–­
[æ ¹æ®äº”è¡Œæ—ºè¡°æ¨ç®—çš„æ—¶é—´]

## ğŸ’¡ è¡ŒåŠ¨å»ºè®®
- **æœ‰åˆ©æ–¹ä½**ï¼š[Xæ–¹]
- **æœ‰åˆ©æ—¶æœº**ï¼š[å…·ä½“æ—¶é—´]
- **æ³¨æ„äº‹é¡¹**ï¼š[ç®€è¿°]
"""

# å¥‡é—¨éç”²è¾“å‡ºæ¡†æ¶
QIMEN_FRAMEWORK = """
## âš¡ ç›˜å±€ä¿¡æ¯
- **èŠ‚æ°”**ï¼š[èŠ‚æ°”] | **é˜´é˜³é**ï¼š[é˜´/é˜³é]
- **å€¼ç¬¦**ï¼š[å¤©å¹²] | **å€¼ä½¿**ï¼š[å…«é—¨]

## ğŸ¯ æ ¸å¿ƒæ–­è¯­
[ä¸€å¥è¯ç›´æ–­å‰å‡¶]

**æˆåŠŸæ¦‚ç‡**ï¼š[XX%]

## ğŸ“Š ç”¨ç¥å®«ä½
- **ç”¨ç¥è½å®«**ï¼š[ç¬¬Xå®«]
- **å¤©ç›˜**ï¼š[å¹²] | **åœ°ç›˜**ï¼š[å¹²]
- **å…«é—¨**ï¼š[é—¨] | **ä¹æ˜Ÿ**ï¼š[æ˜Ÿ] | **å…«ç¥**ï¼š[ç¥]

## ğŸ” æ ¼å±€åˆ†æ
[è¯†åˆ«å‰æ ¼å‡¶æ ¼ï¼Œåˆ†æå¯¹é—®äº‹çš„å½±å“]

## â° æ—¶æœºå»ºè®®
- **æœ€ä½³æ—¶æœº**ï¼š[å…·ä½“æ—¶é—´]
- **æœ‰åˆ©æ–¹ä½**ï¼š[Xæ–¹]

## ğŸ’¡ ç­–ç•¥å»ºè®®
[åŸºäºç›˜å±€çš„å…·ä½“è¡ŒåŠ¨å»ºè®®]
"""

# åˆå©šåˆ†æè¾“å‡ºæ¡†æ¶
HEHUN_FRAMEWORK = """
## ğŸ‘« åŒæ–¹ä¿¡æ¯
| é¡¹ç›® | ç”·æ–¹ | å¥³æ–¹ |
|------|------|------|
| å…«å­— | [å››æŸ±] | [å››æŸ±] |
| æ—¥ä¸» | [X] | [X] |
| ç”¨ç¥ | [X] | [X] |

## ğŸ¯ ç»¼åˆå¥‘åˆåº¦
**[XXåˆ†/100åˆ†]**

## ğŸ“Š é…åˆåˆ†æ
| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| äº”è¡Œé…åˆ | [Xåˆ†] | [ç®€è¿°] |
| æ—¥æŸ±é…åˆ | [Xåˆ†] | [ç®€è¿°] |
| ç¥ç…é…åˆ | [Xåˆ†] | [ç®€è¿°] |

## ğŸ’• ç›¸å¤„ç‰¹ç‚¹
- **ä¼˜åŠ¿**ï¼š[åŒæ–¹ç›¸å¤„çš„ä¼˜ç‚¹]
- **æ³¨æ„**ï¼š[å¯èƒ½çš„æ‘©æ“¦ç‚¹]

## ğŸ’ å©šæœŸå»ºè®®
[æ¨èçš„ç»“å©šå¹´ä»½/æœˆä»½]

## ğŸ’¡ ç»è¥å»ºè®®
[2-3æ¡å…·ä½“çš„ç›¸å¤„å»ºè®®]
"""

# æŠ½ç­¾è§£è¯»è¾“å‡ºæ¡†æ¶
CHOUQIAN_FRAMEWORK = """
## ğŸ‹ ç­¾æ–‡ä¿¡æ¯
**ç¬¬[X]ç­¾** | **ç­¾å**ï¼š[ç­¾å]

**ç­¾è¯—**ï¼š
[ç­¾è¯—åŸæ–‡]

## ğŸ¯ ç­¾æ„é€Ÿæ–­
**[ä¸Šä¸Š/ä¸Š/ä¸­/ä¸‹/ä¸‹ä¸‹]ç­¾**

[ä¸€å¥è¯æ¦‚æ‹¬ç­¾æ„]

## ğŸ“– ç­¾è¯—è§£è¯»
[ç­¾è¯—ç™½è¯ç¿»è¯‘å’Œå…¸æ•…è§£é‡Š]

## ğŸ”® å¯¹æ‰€é—®äº‹é¡¹çš„æŒ‡å¼•
[é’ˆå¯¹ç”¨æˆ·é—®é¢˜çš„å…·ä½“è§£è¯»]

## ğŸ’¡ å®œå¿Œæç¤º
- **å®œ**ï¼š[é€‚åˆåšçš„äº‹]
- **å¿Œ**ï¼š[éœ€é¿å…çš„äº‹]

## âœ¨ å¼€è¿å»ºè®®
[1-2æ¡å…·ä½“å¯è¡Œçš„å»ºè®®]
"""

# è¯¸è‘›ç¥ç®—è¾“å‡ºæ¡†æ¶
ZHUGE_FRAMEWORK = """
## ğŸ‹ ç­¾æ–‡ä¿¡æ¯
**ç¬¬[X]ç­¾**

**ç­¾è¯—**ï¼š[ç­¾è¯—åŸæ–‡]

## ğŸ¯ æ ¸å¿ƒæŒ‡å¼•
[ä¸€å¥è¯æ¦‚æ‹¬ç­¾æ„]

## ğŸ“– ç­¾è¯—è§£è¯»
[ç­¾è¯—å…¸æ•…å’Œå«ä¹‰è§£é‡Š]

## ğŸ”® é—®äº‹åˆ†æ
**æˆåŠŸæ¦‚ç‡**ï¼š[XX%]
**åº”æœŸ**ï¼š[æ—¶é—´é¢„æµ‹]

[é’ˆå¯¹ç”¨æˆ·é—®é¢˜çš„å…·ä½“è§£è¯»]

## ğŸ’¡ è¯¸è‘›é”¦å›Š
[åŸºäºç­¾æ„çš„ç­–ç•¥å»ºè®®]
"""


# ==================== å·¥å…·é…ç½® ====================

TOOL_FRAMEWORKS: Dict[str, str] = {
    "bazi_analysis": BAZI_FRAMEWORK,
    "birthday_divination": BAZI_FRAMEWORK,
    "liuyao_analysis": LIUYAO_FRAMEWORK,
    "tarot_reading": TAROT_FRAMEWORK,
    "tarot_divination": TAROT_FRAMEWORK,
    "ziwei_divination": ZIWEI_FRAMEWORK,
    "ziwei": ZIWEI_FRAMEWORK,
    "xiaoliu_analysis": XIAOLIU_FRAMEWORK,
    "xiaoliu_divination": XIAOLIU_FRAMEWORK,
    "dream_divination": DREAM_FRAMEWORK,
    "name_divination": NAME_FRAMEWORK,
    "name_analysis": NAME_FRAMEWORK,
    "plum_flower_divination": MEIHUA_FRAMEWORK,
    "plum_flower": MEIHUA_FRAMEWORK,
    "qimen_divination": QIMEN_FRAMEWORK,
    "qimen_analysis": QIMEN_FRAMEWORK,
    "hehun_divination": HEHUN_FRAMEWORK,
    "hehun_analysis": HEHUN_FRAMEWORK,
    "chouqian_analysis": CHOUQIAN_FRAMEWORK,
    "zhuge_divination": ZHUGE_FRAMEWORK,
}


class OutputLengthController:
    """è¾“å‡ºæ§åˆ¶å™¨"""
    
    def __init__(self):
        self._tool_frameworks = TOOL_FRAMEWORKS.copy()
    
    def get_framework(self, tool_name: str) -> str:
        """è·å–å·¥å…·çš„è¾“å‡ºæ¡†æ¶"""
        return self._tool_frameworks.get(tool_name, "")
    
    def build_output_prompt(self, tool_name: str) -> str:
        """æ„å»ºè¾“å‡ºè¦æ±‚æç¤ºè¯"""
        framework = self.get_framework(tool_name)
        
        if framework:
            return f"""ã€è¾“å‡ºæ¡†æ¶ã€‘
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ¡†æ¶ç»“æ„è¾“å‡ºåˆ†ææŠ¥å‘Šï¼š
{framework}

ã€è¾“å‡ºè¦æ±‚ã€‘
1. ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ¡†æ¶ç»“æ„è¾“å‡ºï¼Œä¸è¦é—æ¼ä»»ä½•éƒ¨åˆ†
2. æ¯ä¸ªéƒ¨åˆ†å†…å®¹ç²¾ç‚¼ä¸“ä¸šï¼Œä¸è¦åºŸè¯
3. éœ€è¦é‡åŒ–çš„åœ°æ–¹å¿…é¡»ç»™å‡ºå…·ä½“æ•°å€¼ï¼ˆè¯„åˆ†ã€æ¦‚ç‡ã€æ—¶é—´ç­‰ï¼‰
4. ä½¿ç”¨Markdownæ ¼å¼ï¼Œå±‚æ¬¡æ¸…æ™°"""
        else:
            return """ã€è¾“å‡ºè¦æ±‚ã€‘
1. ç»“æ„æ¸…æ™°ï¼Œåˆ†ç‚¹è®ºè¿°
2. å†…å®¹ä¸“ä¸šç²¾ç‚¼ï¼Œä¸è¦åºŸè¯
3. éœ€è¦é‡åŒ–çš„åœ°æ–¹å¿…é¡»ç»™å‡ºå…·ä½“æ•°å€¼
4. ä½¿ç”¨Markdownæ ¼å¼"""
    
    def enhance_prompt(self, original_prompt: str, tool_name: str = None) -> str:
        """å¢å¼ºåŸå§‹æç¤ºè¯ï¼Œæ·»åŠ è¾“å‡ºæ¡†æ¶"""
        output_prompt = self.build_output_prompt(tool_name)
        return f"{original_prompt}\n\n{output_prompt}"
    
    def get_max_tokens(self, tool_name: str = None) -> int:
        """è·å–æœ€å¤§tokenæ•°"""
        return 16000
    
    def parse_mode(self, mode_str: str) -> OutputMode:
        """è§£ææ¨¡å¼å­—ç¬¦ä¸²"""
        return OutputMode.DETAILED
    
    def get_config(self, mode: OutputMode = None, tool_name: str = None) -> OutputConfig:
        """è·å–è¾“å‡ºé…ç½®"""
        return OutputConfig(
            mode=OutputMode.DETAILED,
            max_tokens=16000,
            output_framework=self.get_framework(tool_name) if tool_name else ""
        )


# å…¨å±€å•ä¾‹
output_controller = OutputLengthController()


def enhance_prompt_with_length_control(prompt: str, mode: str = "detailed",
                                        tool_name: str = None) -> str:
    """ä¾¿æ·å‡½æ•°ï¼šå¢å¼ºæç¤ºè¯"""
    return output_controller.enhance_prompt(prompt, tool_name)


def get_output_max_tokens(mode: str = "detailed", tool_name: str = None) -> int:
    """ä¾¿æ·å‡½æ•°ï¼šè·å–æœ€å¤§tokenæ•°"""
    return 16000


def get_tool_framework(tool_name: str) -> str:
    """ä¾¿æ·å‡½æ•°ï¼šè·å–å·¥å…·è¾“å‡ºæ¡†æ¶"""
    return output_controller.get_framework(tool_name)
