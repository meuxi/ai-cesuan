# -*- coding: utf-8 -*-
"""
八字常量定义
基于《子平基础概要》的核心常量

数据来源：Y-AI-Fortune项目 constants.py
"""

from typing import Dict, List

# ========== 天干地支 ==========

HEAVENLY_STEMS = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]
EARTHLY_BRANCHES = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]

# ========== 五行 ==========

FIVE_ELEMENTS = {
    "木": ["甲", "乙", "寅", "卯"],
    "火": ["丙", "丁", "午", "巳"],
    "土": ["戊", "己", "辰", "戌", "丑", "未"],
    "金": ["庚", "辛", "申", "酉"],
    "水": ["壬", "癸", "子", "亥"]
}

# 天干五行映射
STEM_ELEMENT = {
    '甲': '木', '乙': '木',
    '丙': '火', '丁': '火',
    '戊': '土', '己': '土',
    '庚': '金', '辛': '金',
    '壬': '水', '癸': '水'
}

# 地支五行映射
BRANCH_ELEMENT = {
    '子': '水', '丑': '土', '寅': '木', '卯': '木',
    '辰': '土', '巳': '火', '午': '火', '未': '土',
    '申': '金', '酉': '金', '戌': '土', '亥': '水'
}

# ========== 五虎遁月表（P14）==========
# 根据年干确定月干
# 口诀：甲己之年丙作首，乙庚之年戊为头，
#       丙辛之岁庚寅起，丁壬壬寅顺行流，
#       戊癸之年甲寅起，年干五虎遁月求。

WU_HU_DUN_MONTH = {
    # 甲己年：正月丙寅、二月丁卯、三月戊辰...
    "甲": ["丙寅", "丁卯", "戊辰", "己巳", "庚午", "辛未", "壬申", "癸酉", "甲戌", "乙亥", "丙子", "丁丑"],
    "己": ["丙寅", "丁卯", "戊辰", "己巳", "庚午", "辛未", "壬申", "癸酉", "甲戌", "乙亥", "丙子", "丁丑"],
    # 乙庚年：正月戊寅、二月己卯、三月庚辰...
    "乙": ["戊寅", "己卯", "庚辰", "辛巳", "壬午", "癸未", "甲申", "乙酉", "丙戌", "丁亥", "戊子", "己丑"],
    "庚": ["戊寅", "己卯", "庚辰", "辛巳", "壬午", "癸未", "甲申", "乙酉", "丙戌", "丁亥", "戊子", "己丑"],
    # 丙辛年：正月庚寅、二月辛卯、三月壬辰...
    "丙": ["庚寅", "辛卯", "壬辰", "癸巳", "甲午", "乙未", "丙申", "丁酉", "戊戌", "己亥", "庚子", "辛丑"],
    "辛": ["庚寅", "辛卯", "壬辰", "癸巳", "甲午", "乙未", "丙申", "丁酉", "戊戌", "己亥", "庚子", "辛丑"],
    # 丁壬年：正月壬寅、二月癸卯、三月甲辰...
    "丁": ["壬寅", "癸卯", "甲辰", "乙巳", "丙午", "丁未", "戊申", "己酉", "庚戌", "辛亥", "壬子", "癸丑"],
    "壬": ["壬寅", "癸卯", "甲辰", "乙巳", "丙午", "丁未", "戊申", "己酉", "庚戌", "辛亥", "壬子", "癸丑"],
    # 戊癸年：正月甲寅、二月乙卯、三月丙辰...
    "戊": ["甲寅", "乙卯", "丙辰", "丁巳", "戊午", "己未", "庚申", "辛酉", "壬戌", "癸亥", "甲子", "乙丑"],
    "癸": ["甲寅", "乙卯", "丙辰", "丁巳", "戊午", "己未", "庚申", "辛酉", "壬戌", "癸亥", "甲子", "乙丑"],
}

# ========== 五鼠遁日表（P17）==========
# 根据日干确定时干
# 口诀：甲己还加甲，乙庚丙作初，
#       丙辛从戊起，丁壬庚子居，
#       戊癸何方发，壬子是真途。

WU_SHU_DUN_DAY = {
    # 甲己日：子时甲子、丑时乙丑、寅时丙寅...
    "甲": ["甲子", "乙丑", "丙寅", "丁卯", "戊辰", "己巳", "庚午", "辛未", "壬申", "癸酉", "甲戌", "乙亥"],
    "己": ["甲子", "乙丑", "丙寅", "丁卯", "戊辰", "己巳", "庚午", "辛未", "壬申", "癸酉", "甲戌", "乙亥"],
    # 乙庚日：子时丙子、丑时丁丑、寅时戊寅...
    "乙": ["丙子", "丁丑", "戊寅", "己卯", "庚辰", "辛巳", "壬午", "癸未", "甲申", "乙酉", "丙戌", "丁亥"],
    "庚": ["丙子", "丁丑", "戊寅", "己卯", "庚辰", "辛巳", "壬午", "癸未", "甲申", "乙酉", "丙戌", "丁亥"],
    # 丙辛日：子时戊子、丑时己丑、寅时庚寅...
    "丙": ["戊子", "己丑", "庚寅", "辛卯", "壬辰", "癸巳", "甲午", "乙未", "丙申", "丁酉", "戊戌", "己亥"],
    "辛": ["戊子", "己丑", "庚寅", "辛卯", "壬辰", "癸巳", "甲午", "乙未", "丙申", "丁酉", "戊戌", "己亥"],
    # 丁壬日：子时庚子、丑时辛丑、寅时壬寅...
    "丁": ["庚子", "辛丑", "壬寅", "癸卯", "甲辰", "乙巳", "丙午", "丁未", "戊申", "己酉", "庚戌", "辛亥"],
    "壬": ["庚子", "辛丑", "壬寅", "癸卯", "甲辰", "乙巳", "丙午", "丁未", "戊申", "己酉", "庚戌", "辛亥"],
    # 戊癸日：子时壬子、丑时癸丑、寅时甲寅...
    "戊": ["壬子", "癸丑", "甲寅", "乙卯", "丙辰", "丁巳", "戊午", "己未", "庚申", "辛酉", "壬戌", "癸亥"],
    "癸": ["壬子", "癸丑", "甲寅", "乙卯", "丙辰", "丁巳", "戊午", "己未", "庚申", "辛酉", "壬戌", "癸亥"],
}

# ========== 节气名称 ==========

SOLAR_TERMS = [
    "立春", "雨水", "惊蛰", "春分", "清明", "谷雨",
    "立夏", "小满", "芒种", "夏至", "小暑", "大暑",
    "立秋", "处暑", "白露", "秋分", "寒露", "霜降",
    "立冬", "小雪", "大雪", "冬至", "小寒", "大寒"
]

# 节令对应月支（用于判断月柱）
SOLAR_TERM_MONTHS = {
    "立春": "寅", "惊蛰": "卯", "清明": "辰", "立夏": "巳",
    "芒种": "午", "小暑": "未", "立秋": "申", "白露": "酉",
    "寒露": "戌", "立冬": "亥", "大雪": "子", "小寒": "丑"
}

# ========== 十神定义（P86-105）==========

TEN_GODS = {
    "正印": {"meaning": "生我且阴阳异性", "family": "母亲", "effect": "主文书、学业、贵人"},
    "偏印": {"meaning": "生我且阴阳同性", "family": "继母", "effect": "主艺术、偏业、特殊技能"},
    "正官": {"meaning": "克我且阴阳异性", "family": "女命丈夫", "effect": "主官贵、名声、纳音"},
    "七杀": {"meaning": "克我且阴阳同性", "family": "女命偏夫", "effect": "主权威、竞争、压力"},
    "正财": {"meaning": "我克且阴阳异性", "family": "男命正妻", "effect": "主正财、辛勤致富"},
    "偏财": {"meaning": "我克且阴阳同性", "family": "父亲、偏妻", "effect": "主偏财、投机取利"},
    "食神": {"meaning": "我生且阴阳异性", "family": "女儿", "effect": "主口才、艺术、餐饮"},
    "伤官": {"meaning": "我生且阴阳同性", "family": "儿子", "effect": "主反叛、创新、艺术"},
    "比肩": {"meaning": "同我且阴阳同性", "family": "兄弟", "effect": "主友情、合作、竞争"},
    "劫财": {"meaning": "同我且阴阳异性", "family": "姐妹", "effect": "主争夺、投机、破财"}
}

# ========== 格局规则（P35-40）==========

PATTERN_RULES = {
    "正官格": {"condition": "月令正官透干", "use_god": "印绶生身或财生官"},
    "七杀格": {"condition": "月令七杀透干", "use_god": "印绶化杀或食伤制杀"},
    "正财格": {"condition": "月令正财透干", "use_god": "官护财或比劫帮身"},
    "偏财格": {"condition": "月令偏财透干", "use_god": "食伤生财或印绶帮身"},
    "食神格": {"condition": "月令食神透干", "use_god": "财星泄秀或比劫帮身"},
    "伤官格": {"condition": "月令伤官透干", "use_god": "财星泄秀或印绶制伤"},
    "正印格": {"condition": "月令正印透干", "use_god": "官杀生印或财星破印"},
    "偏印格": {"condition": "月令偏印透干", "use_god": "财星制印或食伤泄秀"},
}

# ========== 日主强弱判断规则（P44-49）==========

DAYMASTER_STRENGTH_RULES = {
    "得令": {
        "春": ["木"],      # 春季木旺
        "夏": ["火"],      # 夏季火旺
        "秋": ["金"],      # 秋季金旺
        "冬": ["水"],      # 冬季水旺
        "四季": ["土"]     # 四季末土旺（辰戌丑未月）
    },
    "得地": "日支藏干中有与日干同类或生日干者",
    "得党": "天干中有比劫帮扶日干者"
}

# ========== 地支藏干 ==========

HIDDEN_STEMS = {
    '子': ['癸'],
    '丑': ['己', '癸', '辛'],
    '寅': ['甲', '丙', '戊'],
    '卯': ['乙'],
    '辰': ['戊', '乙', '癸'],
    '巳': ['丙', '庚', '戊'],
    '午': ['丁', '己'],
    '未': ['己', '丁', '乙'],
    '申': ['庚', '壬', '戊'],
    '酉': ['辛'],
    '戌': ['戊', '辛', '丁'],
    '亥': ['壬', '甲']
}

# ========== 辅助函数 ==========

def get_month_ganzhi(year_gan: str, month_index: int) -> str:
    """
    根据年干和月份索引获取月柱
    
    Args:
        year_gan: 年干（甲-癸）
        month_index: 月份索引（1=寅月/正月，2=卯月/二月...12=丑月/腊月）
    
    Returns:
        月柱干支
    """
    if year_gan not in WU_HU_DUN_MONTH:
        return ""
    return WU_HU_DUN_MONTH[year_gan][month_index - 1]


def get_hour_ganzhi(day_gan: str, hour_index: int) -> str:
    """
    根据日干和时辰索引获取时柱
    
    Args:
        day_gan: 日干（甲-癸）
        hour_index: 时辰索引（1=子时，2=丑时...12=亥时）
    
    Returns:
        时柱干支
    """
    if day_gan not in WU_SHU_DUN_DAY:
        return ""
    return WU_SHU_DUN_DAY[day_gan][hour_index - 1]


def get_hidden_stems(branch: str) -> List[str]:
    """获取地支藏干"""
    return HIDDEN_STEMS.get(branch, [])


def get_element(gan_or_zhi: str) -> str:
    """获取天干或地支的五行"""
    return STEM_ELEMENT.get(gan_or_zhi) or BRANCH_ELEMENT.get(gan_or_zhi, '')
