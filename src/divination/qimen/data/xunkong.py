"""
旬空数据
六甲旬空表 - 用于奇门遁甲、六壬等术数推算

旬空原理：
- 天干10个，地支12个，形成60甲子
- 每旬（10天）有2个地支轮空，称为"旬空"
- 六甲（甲子、甲戌、甲申、甲午、甲辰、甲寅）各领一旬

数据来源：马年测算系统 qmdj/xunkong.txt
"""
from typing import Tuple, List, Optional


# 十天干
TIAN_GAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸']

# 十二地支
DI_ZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥']

# 六十甲子
JIA_ZI_60 = [
    '甲子', '乙丑', '丙寅', '丁卯', '戊辰', '己巳', '庚午', '辛未', '壬申', '癸酉',
    '甲戌', '乙亥', '丙子', '丁丑', '戊寅', '己卯', '庚辰', '辛巳', '壬午', '癸未',
    '甲申', '乙酉', '丙戌', '丁亥', '戊子', '己丑', '庚寅', '辛卯', '壬辰', '癸巳',
    '甲午', '乙未', '丙申', '丁酉', '戊戌', '己亥', '庚子', '辛丑', '壬寅', '癸卯',
    '甲辰', '乙巳', '丙午', '丁未', '戊申', '己酉', '庚戌', '辛亥', '壬子', '癸丑',
    '甲寅', '乙卯', '丙辰', '丁巳', '戊午', '己未', '庚申', '辛酉', '壬戌', '癸亥'
]

# 六甲旬空表
# 格式：{旬首: (旬内干支列表, 旬空地支)}
XUN_KONG_TABLE = {
    '甲子': (['甲子', '乙丑', '丙寅', '丁卯', '戊辰', '己巳', '庚午', '辛未', '壬申', '癸酉'], ('戌', '亥')),
    '甲戌': (['甲戌', '乙亥', '丙子', '丁丑', '戊寅', '己卯', '庚辰', '辛巳', '壬午', '癸未'], ('申', '酉')),
    '甲申': (['甲申', '乙酉', '丙戌', '丁亥', '戊子', '己丑', '庚寅', '辛卯', '壬辰', '癸巳'], ('午', '未')),
    '甲午': (['甲午', '乙未', '丙申', '丁酉', '戊戌', '己亥', '庚子', '辛丑', '壬寅', '癸卯'], ('辰', '巳')),
    '甲辰': (['甲辰', '乙巳', '丙午', '丁未', '戊申', '己酉', '庚戌', '辛亥', '壬子', '癸丑'], ('寅', '卯')),
    '甲寅': (['甲寅', '乙卯', '丙辰', '丁巳', '戊午', '己未', '庚申', '辛酉', '壬戌', '癸亥'], ('子', '丑')),
}

# 干支到旬空的快速查询表
# 格式：{干支: (旬空1, 旬空2)}
GAN_ZHI_XUN_KONG = {}
for xun_shou, (gan_zhi_list, kong) in XUN_KONG_TABLE.items():
    for gz in gan_zhi_list:
        GAN_ZHI_XUN_KONG[gz] = kong


def get_xun_kong(gan_zhi: str) -> Tuple[str, str]:
    """
    获取干支的旬空
    
    Args:
        gan_zhi: 干支，如"甲子"、"乙丑"等
        
    Returns:
        旬空的两个地支，如('戌', '亥')
    """
    if gan_zhi in GAN_ZHI_XUN_KONG:
        return GAN_ZHI_XUN_KONG[gan_zhi]
    raise ValueError(f"无效的干支: {gan_zhi}")


def get_xun_shou(gan_zhi: str) -> str:
    """
    获取干支所在旬的旬首
    
    Args:
        gan_zhi: 干支，如"甲子"、"乙丑"等
        
    Returns:
        旬首干支，如"甲子"
    """
    for xun_shou, (gan_zhi_list, _) in XUN_KONG_TABLE.items():
        if gan_zhi in gan_zhi_list:
            return xun_shou
    raise ValueError(f"无效的干支: {gan_zhi}")


def is_kong(gan_zhi: str, di_zhi: str) -> bool:
    """
    判断地支是否落入旬空
    
    Args:
        gan_zhi: 日干支，用于确定旬空
        di_zhi: 要检查的地支
        
    Returns:
        是否空亡
    """
    kong = get_xun_kong(gan_zhi)
    return di_zhi in kong


def get_jia_zi_index(gan_zhi: str) -> int:
    """
    获取干支在六十甲子中的索引（0-59）
    
    Args:
        gan_zhi: 干支
        
    Returns:
        索引值
    """
    if gan_zhi in JIA_ZI_60:
        return JIA_ZI_60.index(gan_zhi)
    raise ValueError(f"无效的干支: {gan_zhi}")


def get_gan_zhi_by_index(index: int) -> str:
    """
    根据索引获取干支
    
    Args:
        index: 索引值（0-59）
        
    Returns:
        干支
    """
    return JIA_ZI_60[index % 60]


# 地支六冲
DI_ZHI_CHONG = {
    '子': '午', '午': '子',
    '丑': '未', '未': '丑',
    '寅': '申', '申': '寅',
    '卯': '酉', '酉': '卯',
    '辰': '戌', '戌': '辰',
    '巳': '亥', '亥': '巳'
}

# 地支六合
DI_ZHI_HE = {
    '子': '丑', '丑': '子',
    '寅': '亥', '亥': '寅',
    '卯': '戌', '戌': '卯',
    '辰': '酉', '酉': '辰',
    '巳': '申', '申': '巳',
    '午': '未', '未': '午'
}

# 地支三合局
DI_ZHI_SAN_HE = {
    '申子辰': '水',
    '寅午戌': '火',
    '巳酉丑': '金',
    '亥卯未': '木'
}

# 地支三会局
DI_ZHI_SAN_HUI = {
    '寅卯辰': '木',
    '巳午未': '火',
    '申酉戌': '金',
    '亥子丑': '水'
}
